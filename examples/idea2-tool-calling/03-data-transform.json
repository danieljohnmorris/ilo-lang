{
  "function": "classify",
  "input": {"spent": "number"},
  "output": "text",
  "steps": [
    {"if": {">=": ["$input.spent", 1000]}, "return": "gold"},
    {"if": {">=": ["$input.spent", 500]}, "return": "silver"},
    {"return": "bronze"}
  ]
}

{
  "function": "summaries",
  "input": {"customers": "list customer"},
  "output": "list summary",
  "deps": ["classify"],
  "steps": [
    {"for": "c", "in": "$input.customers", "do": [
      {"let": "level", "call": "classify", "args": {"spent": "$c.spent"}},
      {"let": "disc", "match": "$level", "cases": {"gold": 20, "silver": 10, "bronze": 5}},
      {"yield": {"name": "$c.name", "level": "$level", "discount": "$disc"}}
    ]}
  ]
}
