{
  "meta": {
    "tools": ["mcp://address/validate", "mcp://rates/shipping", "mcp://pricing/discount"],
    "input": {"order": "order"},
    "output": "result order text"
  },
  "steps": [
    {"let": "valid", "call": "mcp://address/validate", "with": {"addr": "$.order.addr"},
     "err": "Invalid shipping address"},
    {"let": "ship", "call": "mcp://rates/shipping", "with": {"weight": "$.order.weight", "dest": "$.order.addr.country"}},
    {"let": "disc", "call": "mcp://pricing/discount", "with": {"subtotal": "$.order.subtotal", "code": "$.order.code"}},
    {"let": "final", "expr": {"+":[{"-":["$.order.subtotal","$disc"]},"$ship"]}},
    {"ok": {"merge": "$.order", "set": {"total": "$final", "cost": "$ship"}}}
  ]
}
