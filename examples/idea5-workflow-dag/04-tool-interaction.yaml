name: notify
input:
  user-id: text
  message: text
output: result nil, text

steps:
  fetch:
    call: get-user
    args:
      user-id: $.user-id
    catch:
      return:
        error: "User lookup failed: ${error}"

  check:
    if:
      not: ${fetch.verified}
    then:
      return:
        error: "Email not verified"

  send:
    call: send-email
    args:
      to: ${fetch.email}
      subject: "Notification"
      body: $.message
    catch:
      return:
        error: "Send failed: ${error}"

  done:
    return:
      ok: null
