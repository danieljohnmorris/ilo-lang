name: classify
input:
  spent: number
output: text

steps:
  check:
    switch:
      - if: "$.spent >= 1000"
        return: "gold"
      - if: "$.spent >= 500"
        return: "silver"
      - default:
        return: "bronze"

---

name: summaries
input:
  customers: list customer
output: list summary

steps:
  map:
    for: c
    in: $.customers
    yield:
      level:
        call: classify
        args:
          spent: ${c.spent}
      disc:
        match: ${level}
        cases:
          gold: 20
          silver: 10
          bronze: 5
      result:
        name: ${c.name}
        level: ${level}
        discount: ${disc}
